---
import { inspectionScopeMailtoHref } from "../lib/contact";

type NavItem = { href: string; label: string };

const {
  title = "Sayyidi Shaarani",
  description = "",
  canonicalPath = "/",
  ogType = "website",
  ogImagePath = "/og.png",
  structuredData = null,
} = Astro.props;

const DOMAIN = "https://sayyidishaarani.com";
const safePath = (canonicalPath || "/").startsWith("/")
  ? canonicalPath
  : `/${canonicalPath}`;

const canonicalUrl = `${DOMAIN}${safePath}`;
const currentPath = Astro.url?.pathname || safePath;

/**
 * Single source of truth for navigation
 */
const nav: NavItem[] = [
  { href: "/inspection/", label: "Inspection" },
  { href: "/about/", label: "About" },
  { href: "/notes/", label: "Notes" },
  { href: inspectionScopeMailtoHref, label: "Contact" },
];

const isMailto = (href: string) => href.startsWith("mailto:");

const isCurrent = (href: string): boolean => {
  if (isMailto(href)) return false;

  const normalizedHref = href.endsWith("/") ? href : `${href}/`;
  const normalizedPath = currentPath.endsWith("/")
    ? currentPath
    : `${currentPath}/`;

  return normalizedHref === normalizedPath;
};
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>{title}</title>
    {description && <meta name="description" content={description} />}

    <link rel="canonical" href={canonicalUrl} />

    <meta property="og:title" content={title} />
    {description && <meta property="og:description" content={description} />}
    <meta property="og:type" content={ogType} />
    <meta property="og:url" content={canonicalUrl} />
    <meta property="og:image" content={`${DOMAIN}${ogImagePath}`} />

    <meta name="twitter:card" content="summary" />
    {structuredData && (
      <script
        type="application/ld+json"
        set:html={JSON.stringify(structuredData)}
      />
    )}

    <style is:global>
      :root {
        --max-width: 820px;
        --measure: 66ch;
        --content-top: clamp(3.25rem, 5.6vw, 4.2rem);
        --text: #0f172a;
        --muted: #475569;
        --border: #cbd5e1;
        --bg: #f6f8fb;
        --bg-soft: #eef2f7;
        --link: #1e3a8a;
        --radius: 12px;

        --space-1: 0.5rem;
        --space-2: 1rem;
        --space-3: 1.5rem;
        --space-4: 2.5rem;
        --space-5: 4rem;
        --space-6: 6rem;
      }

      * { box-sizing: border-box; }

      body {
        font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont,
          "Segoe UI", Roboto, sans-serif;
        margin: 0;
        font-size: clamp(1rem, 0.98rem + 0.2vw, 1.06rem);
        color: var(--text);
        background: var(--bg);
        line-height: 1.74;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }

      a {
        color: var(--link);
        text-underline-offset: 2px;
        text-decoration-thickness: 0.08em;
      }
      a:hover { text-decoration: underline; }

      a:focus-visible {
        outline: 2px solid var(--text);
        outline-offset: 3px;
        border-radius: 6px;
      }

      .skip {
        position: absolute;
        left: -999px;
        top: auto;
        width: 1px;
        height: 1px;
        overflow: hidden;
      }

      .skip:focus {
        position: static;
        width: auto;
        height: auto;
        margin: var(--space-2);
        padding: 0.6rem 0.8rem;
        border: 1px solid var(--border);
        border-radius: 10px;
        background: var(--bg-soft);
        display: inline-block;
      }

      .inner {
        max-width: var(--max-width);
        margin: 0 auto;
        padding: 0 var(--space-2);
      }

      .siteHeader {
        border-bottom: 1px solid var(--border);
        padding: 0.95rem 0;
      }

      .siteHeader > .inner {
        display: flex;
        justify-content: space-between;
        align-items: baseline;
        gap: 0.75rem;
      }

      .brand a {
        text-decoration: none;
        color: var(--text);
        letter-spacing: 0.01em;
      }

      .brand a:hover {
        text-decoration: underline;
      }

      nav.siteNav {
        display: flex;
        align-items: baseline;
        gap: 0.7rem;
      }

      nav.siteNav a {
        text-decoration: none;
        color: var(--muted);
        font-size: 0.98rem;
        white-space: nowrap;
      }

      nav.siteNav a:hover {
        color: var(--text);
      }

      nav.siteNav a[aria-current="page"] {
        color: var(--text);
        text-decoration: underline;
        text-underline-offset: 4px;
      }

      main {
        display: block;
        margin: var(--content-top) auto var(--space-5);
      }

      section { margin: var(--space-5) 0; }

      main > :where(section, article):first-child {
        margin-top: clamp(1.1rem, 2.5vw, 1.8rem);
      }

      main > :where(section, article):last-child {
        margin-bottom: 0;
      }

      h1, h2, h3 {
        line-height: 1.25;
        margin: 0 0 var(--space-2) 0;
        letter-spacing: -0.01em;
        text-wrap: balance;
      }

      h1 { font-size: clamp(1.9rem, 2.6vw, 2.4rem); }
      h2 { font-size: clamp(1.32rem, 2.15vw, 1.8rem); }
      h3 { font-size: clamp(1.06rem, 1.5vw, 1.22rem); }

      p { margin: 0 0 var(--space-2) 0; }

      .muted { color: var(--muted); }

      .lede {
        font-size: clamp(1.08rem, 1.03rem + 0.35vw, 1.18rem);
        line-height: 1.62;
        max-width: 62ch;
        margin-bottom: var(--space-2);
      }

      main :where(p, ul, ol, blockquote) {
        max-width: var(--measure);
      }

      main :where(p, li) {
        line-height: 1.74;
      }

      main :where(ul, ol) {
        margin: 0 0 var(--space-2) 0;
        padding-left: 1.2rem;
      }

      main :where(li + li) {
        margin-top: 0.35rem;
      }

      .ctaRow {
        display: flex;
        flex-wrap: wrap;
        gap: 0.75rem;
        margin-top: var(--space-3);
      }

      .cta {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 0.66rem 0.95rem;
        border-radius: 10px;
        border: 1px solid var(--border);
        color: var(--text);
        text-decoration: none;
        font-size: 0.98rem;
        line-height: 1.2;
      }

      .cta:hover {
        text-decoration: none;
        border-color: #c8c8c8;
        background: var(--bg-soft);
      }

      .ctaPrimary {
        background: var(--text);
        color: #fff;
        border-color: var(--text);
      }

      .ctaPrimary:hover {
        background: #1e293b;
        border-color: #1e293b;
      }

      .ctaSecondary {
        background: var(--bg);
      }

      hr {
        border: 0;
        border-top: 1px solid var(--border);
        margin: var(--space-3) 0;
      }

      :target {
        scroll-margin-top: var(--space-5);
      }

      footer.inner {
        border-top: 1px solid var(--border);
        padding: var(--space-4) var(--space-2);
        margin-top: var(--space-5);
        font-size: 0.9rem;
        color: var(--muted);
      }

      footer.inner p {
        margin: 0;
      }

      .footerLinks {
        margin-top: 0.35rem;
      }

      .footerLinks a {
        color: var(--muted);
      }

      .footerLinks a:hover {
        color: var(--text);
      }

      @media (max-width: 520px) {
        .siteHeader > .inner {
          flex-direction: column;
          align-items: flex-start;
        }
      }

      @media (max-width: 640px) {
        main {
          margin: var(--space-3) auto var(--space-4);
        }

        main > :where(section, article):first-child {
          margin-top: 0.9rem;
        }

        section {
          margin: var(--space-4) 0;
        }

        .cta {
          width: 100%;
        }
      }
    </style>
  </head>

  <body>
    <a class="skip" href="#content">Skip to content</a>

    <header class="siteHeader">
      <div class="inner">
        <div class="brand">
          <strong><a href="/">Sayyidi Shaarani</a></strong>
        </div>

        <nav class="siteNav" aria-label="Primary">
          {nav.map((item) => (
            <a
              href={item.href}
              aria-current={isCurrent(item.href) ? "page" : undefined}
            >
              {item.label}
            </a>
          ))}
        </nav>
      </div>
    </header>

    <main id="content" class="inner">
      <slot />
    </main>

    <footer class="inner">
      <p>© {new Date().getFullYear()} by Sayyidi Shaarani</p>
      <p class="footerLinks">
        <a href="/inspection/">Inspection</a> · <a href="/notes/">Notes</a> ·
        <a href="/boundaries/">Engagement Boundaries</a> ·
        <a href="/disclosure/">Security Disclosure Policy</a>
      </p>
    </footer>
  </body>
</html>
