---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection, type CollectionEntry } from "astro:content";

type Post = CollectionEntry<"posts">;

const title = "Notes | Sayyidi Shaarani";
const description =
  "Applied security research and inspection notes. Structured observations on web application risk and inspection practice.";

const posts = (await getCollection("posts"))
  .filter((p: Post) => !p.data.draft)
  .sort((a: Post, b: Post) => b.data.date.valueOf() - a.data.date.valueOf());

const taxonomyGuide = [
  {
    label: "When to Inspect",
    description: "When structured inspection is likely to reduce material risk.",
  },
  {
    label: "How Inspection Works",
    description: "How scope, validation, and reporting are performed.",
  },
  {
    label: "How to Act on Findings",
    description: "How to prioritize and act on inspection output.",
  },
  {
    label: "Scope and Boundaries",
    description: "How inspection differs from adjacent services and where limits apply.",
  },
];
---

<BaseLayout title={title} description={description} canonicalPath="/notes/">
  <section class="notesIndex" aria-labelledby="notes-title">
    <h1 id="notes-title">Notes</h1>

    <p class="muted intro">
      Reference notes on inspection methodology, risk visibility, and practical
      security decision support.
    </p>

    <section class="taxonomy" aria-labelledby="taxonomy-title">
      <h2 id="taxonomy-title">Taxonomy</h2>
      <dl class="taxonomyList">
        {taxonomyGuide.map((item) => (
          <div class="taxonomyItem">
            <dt>{item.label}</dt>
            <dd>{item.description}</dd>
          </div>
        ))}
      </dl>
    </section>

    {posts.length === 0 ? (
      <p class="muted">No notes published yet.</p>
    ) : (
      <div class="notesList">
        {posts.map((post: Post) => (
          <article class="noteItem" aria-labelledby={`note-${post.slug}`}>
            <h2 id={`note-${post.slug}`}>
              <a href={`/notes/${post.slug}/`}>{post.data.title}</a>
            </h2>

            <p>{post.data.description}</p>

            <p class="meta" aria-label="Primary note label">
              {post.data.primaryLabel}
            </p>

            <p class="readLink">
              <a href={`/notes/${post.slug}/`}>Read note</a>
            </p>
          </article>
        ))}
      </div>
    )}
  </section>
</BaseLayout>

<style>
  .notesIndex {
    margin-top: var(--space-3);
  }

  .intro {
    max-width: 66ch;
    margin-bottom: var(--space-3);
  }

  .taxonomy {
    margin: 0 0 var(--space-4);
  }

  .taxonomy h2 {
    font-size: 1rem;
    margin-bottom: 0.7rem;
  }

  .taxonomyList {
    margin: 0;
  }

  .taxonomyItem {
    margin-bottom: 0.6rem;
  }

  .taxonomyItem dt {
    font-size: 0.9rem;
    color: var(--text);
  }

  .taxonomyItem dd {
    margin: 0.15rem 0 0;
    color: var(--muted);
    font-size: 0.86rem;
    max-width: 68ch;
  }

  .notesList {
    border-top: 1px solid var(--border);
    margin-top: var(--space-3);
  }

  .noteItem {
    padding: var(--space-3) 0;
    border-bottom: 1px solid var(--border);
  }

  .noteItem h2 {
    font-size: clamp(1.2rem, 2.1vw, 1.45rem);
    text-transform: none;
    letter-spacing: 0;
    margin-bottom: 0.75rem;
  }

  .noteItem h2 a {
    color: var(--text);
    text-decoration: none;
  }

  .noteItem h2 a:hover {
    text-decoration: underline;
  }

  .meta {
    margin: 0.8rem 0 0;
    color: var(--muted);
    font-size: 0.86rem;
  }

  .readLink {
    margin-top: 0.7rem;
    margin-bottom: 0;
  }
</style>
