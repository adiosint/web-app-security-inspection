---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection, type CollectionEntry } from "astro:content";

type Post = CollectionEntry<"posts">;

const title = "Notes | Sayyidi Shaarani";
const description =
  "Practical notes on web application security risk, inspection process, and follow-up decisions.";

const posts = (await getCollection("posts"))
  .filter((p: Post) => !p.data.draft)
  .sort((a: Post, b: Post) => b.data.date.valueOf() - a.data.date.valueOf());

const labelOrder = [
  "When to Inspect",
  "How Inspection Works",
  "How to Act on Findings",
  "Scope and Boundaries",
];

const labelsInUse = labelOrder.filter((label) =>
  posts.some((post: Post) => post.data.primaryLabel === label)
);
---

<BaseLayout title={title} description={description} canonicalPath="/notes/">
  <section class="notesIndex" aria-labelledby="notes-title">
    <h1 id="notes-title">Notes</h1>

    <p class="muted intro">
      Practical notes on how inspections work, which risks matter most, and
      how teams can act on findings.
    </p>

    {labelsInUse.length > 0 && (
      <p class="muted taxonomyHint" aria-label="Current note labels">
        Labels: {labelsInUse.join(" Â· ")}
      </p>
    )}

    {posts.length === 0 ? (
      <p class="muted">No notes published yet.</p>
    ) : (
      <div class="notesList">
        {posts.map((post: Post) => (
          <article class="noteItem" aria-labelledby={`note-${post.slug}`}>
            <h2 id={`note-${post.slug}`}>
              <a href={`/notes/${post.slug}/`}>{post.data.title}</a>
            </h2>

            <p class="meta" aria-label="Primary note label">
              {post.data.primaryLabel}
            </p>

            <p class="noteSummary">{post.data.description}</p>

            <p class="readLink">
              <a href={`/notes/${post.slug}/`}>Read Note</a>
            </p>
          </article>
        ))}
      </div>
    )}
  </section>
</BaseLayout>

<style>
  .notesIndex {
    margin-top: 0;
    max-width: 66ch;
  }

  .intro {
    max-width: 62ch;
    font-size: 1.04rem;
    line-height: 1.66;
    margin-bottom: var(--space-2);
  }

  .taxonomyHint {
    margin: 0 0 var(--space-3);
    font-size: 0.9rem;
  }

  .notesList {
    border-top: 1px solid var(--border);
    margin-top: var(--space-3);
  }

  .noteItem {
    padding: var(--space-3) 0;
    border-bottom: 1px solid var(--border);
  }

  .noteItem h2 {
    font-size: clamp(1.2rem, 2.1vw, 1.45rem);
    text-transform: none;
    letter-spacing: 0;
    margin-bottom: 0.75rem;
  }

  .noteItem h2 a {
    color: var(--text);
    text-decoration: none;
  }

  .noteItem h2 a:hover {
    text-decoration: underline;
    text-underline-offset: 3px;
  }

  .meta {
    margin: 0.2rem 0 0.55rem;
    color: var(--muted);
    font-size: 0.86rem;
  }

  .noteSummary {
    max-width: 62ch;
    line-height: 1.68;
    margin: 0;
  }

  .readLink {
    margin-top: 0.85rem;
    margin-bottom: 0;
    font-size: 0.94rem;
  }
</style>
